<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Gesture Recognition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        .highlight {
            background-color: yellow;
            font-weight: bold;
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.3s ease-in-out;
        }
        #current_note {
            font-size: 32px; /* TÄƒng kÃ­ch thÆ°á»›c chá»¯ */
            font-weight: bold; /* LÃ m Ä‘áº­m chá»¯ */
            text-align: center; /* CÄƒn giá»¯a chá»¯ */
            color: white; /* MÃ u chá»¯ Ä‘á» */
            background-color: gray; /* Ná»n mÃ u vÃ ng */
            padding: 10px; /* Táº¡o khoáº£ng cÃ¡ch bÃªn trong */
            border-radius: 5px; /* Bo gÃ³c */
        }
        #song_notes {
            font-size: 32px; /* TÄƒng kÃ­ch thÆ°á»›c chá»¯ */
            font-weight: bold; /* Chá»¯ in Ä‘áº­m */
            text-align: center; /* CÄƒn giá»¯a */
            color: rgb(0, 157, 255); /* MÃ u chá»¯ xanh */
            background-color: lightblue; /* Ná»n xanh nháº¡t */
            padding: 15px; /* TÄƒng khoáº£ng cÃ¡ch bÃªn trong */
            border-radius: 8px; /* Bo gÃ³c */
        }
    </style>
</head>

<body class="container mt-4">
    <div class="row">
        <div class="col-md-6">
            <h2>ğŸµ Chá»n bÃ i hÃ¡t</h2>
            <div class="input-group mb-3">
                <select id="songSelector" class="form-select">
                    <option value="" disabled selected>Chá»n bÃ i hÃ¡t...</option>
                    <option value="Happy Birthday">Happy Birthday</option>
                    <option value="Twinkle Twinkle">Twinkle Twinkle</option>
                    <option value="ÄaÌ€n gaÌ€ con">ÄaÌ€n gaÌ€ con</option>
                    <option value="KiÌ€a con bÆ°Æ¡Ìm vaÌ€ng">KiÌ€a con bÆ°Æ¡Ìm vaÌ€ng</option>
                </select>
                <button class="btn btn-primary" onclick="confirmSong()">Chá»n</button>
            </div>
    
            <h2>ğŸ¼ BÃ i hÃ¡t hiá»‡n táº¡i</h2>
            <p id="song_notes" class="alert alert-info">ChÆ°a chá»n bÃ i</p>
    
            <h2>ğŸ¹ Ná»‘t Ä‘ang nháº¥n:</h2>
            <p id="current_note" class="alert alert-warning">---</p>
        </div>
    
        <!-- Cá»™t 2: Hiá»ƒn thá»‹ Camera -->
        <div class="col-md-6 text-center full-height">
            <img src="{{ url_for('video_feed') }}" class="img-fluid border rounded" width="640" height="480">
        </div>
    </div>

    

    <script>
        var socket = io.connect("http://" + document.domain + ":" + location.port);
        var currentIndex = 0; // Chá»‰ sá»‘ cá»§a ná»‘t hiá»‡n táº¡i

        function confirmSong() {
            var songName = $("#songSelector").val();
            if (songName) {
                fetch('/set_song/' + songName)
                    .then(response => response.json())
                    .then(data => {
                        console.log("BÃ i hÃ¡t Ä‘Ã£ chá»n:", data.song);
                        currentIndex = 0; // Reset vá» ná»‘t Ä‘áº§u tiÃªn
                    });
            } else {
                alert("Vui lÃ²ng chá»n má»™t bÃ i hÃ¡t!");
            }
        }

        socket.on('update_song', function (data) {
            let notesHtml = data.notes.map((note, index) =>
                `<span class="song-note ${index === 0 ? 'highlight' : ''}">${note}</span>`).join(" ");
            $("#song_notes").html(`${notesHtml}`);
            currentIndex = 0; // Báº¯t Ä‘áº§u tá»« ná»‘t Ä‘áº§u tiÃªn
        });

        socket.on('note_pressed', function (data) {
                document.getElementById('current_note').innerText = "" + data.note;
            });

        socket.on('note_pressed', function (data) {
            let notes = $(".song-note");
            let currentNote = notes.eq(currentIndex).text();

            // Kiá»ƒm tra náº¿u ná»‘t Ä‘Æ°á»£c nháº¥n lÃ  ná»‘t Ä‘Ãºng
            if (data.note === currentNote) {
                notes.eq(currentIndex).removeClass("highlight").addClass("text-success"); // ÄÃ¡nh dáº¥u Ä‘Ã£ nháº¥n thÃ nh cÃ´ng
                currentIndex++;

                if (currentIndex < notes.length) {
                    notes.eq(currentIndex).addClass("highlight"); // Highlight ná»‘t tiáº¿p theo
                }
            }
        });
    </script>
</body>

</html>